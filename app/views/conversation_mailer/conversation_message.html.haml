%style{data: {immutable: true}}=Rails.application.assets['email_mobile.css']
- button_defaults = { border: '#cccccc', background: '#fcfcfc', text: '#1abc9c'}
%div.threadable-content
  %div{:style => "display:none; display:none !important;"}
    = @message_summary
    = "##CovMid: #{@message.unique_id} ##"
  %table.threadable-controls{:border => "0", :cellpadding => "0", :color => "dark grey", :width => "100%"}
    %tr
      %td
        %table.threadable-button-table{:align => "left", :border => "0", :cellpadding => "0", :cellspacing => "0"}
          %tr
            = email_button "Web view",         @message_url,           class: 'view-button'
            = email_button "Mute", email_action_link(@conversation, @recipient, "mute"), class: 'mute-button'
            - if @task
              - if @task.doers.include? @recipient
                = email_button "Remove me", email_action_link(@conversation, @recipient, "remove")
              - else
                = email_button "I'll do it!", email_action_link(@conversation, @recipient, "add")
              - if @task.done?
                = email_button "Task undone", email_action_link(@conversation, @recipient, "undone")
              - else
                = email_button "Task done", email_action_link(@conversation, @recipient, "done")
            - else
              %td
              %td

        %table.threadable-button-table{:align => "left", :border => "0", :cellpadding => "0", :cellspacing => "0"}
          %tr
            %td
              %table.threadable-group-indicator{border: 0, cellpadding: 0, cellspacing: 3, class: @group_indicator_options[:class], style: "background-color: #{@group_indicator_options[:color]} !important;"}
                %tr
                  = email_button "New conversation", @new_conversation_url,  class: 'compose-button'
                  = email_button "New task",         @new_task_url,          class: 'compose-button'
                %tr
                  %td.group-name{colspan: 2}
                    = @group_indicator_options[:name]


  %div{:style => "display:none; display:none !important; clear: both"}
    = "##CovMid: #{@message.unique_id} ##"

%br

- if @message.body.html?
  = @message.body
- else
  .plain-text= @message.body

%br

%div.threadable-content
  %div{:style => "display:none; display:none !important;"}
    = "##CovMid: footer ##"

  %table.threadable-details{:align => "left", :border => "0", :cellpadding => "0", :cellspacing => "0", :width => "100%"}
    %tr
      %td.threadable-details-inner{:style => "color: #95A5A6; text-align: left;"}
        - if @conversation.groups.count > 0
          .threadable-groups
            = "Conversation in #{'group'.pluralize(@conversation.groups.count)}:"
            - @conversation.groups.all.each do |group|
              .threadable-group
                %b
                  = link_to "+#{group.name}", conversations_url(@organization, group)
                |
                = mail_to group.formatted_email_address, group.email_address
                = "(#{link_to "#{group.members.count} people...", group_members_url(@organization, group)})".html_safe
                |
                = link_to 'Leave', email_action_link(group, @recipient, "leave")

        .threadable-organization{:style => "font-family: Helvetica Neue, Helvetica, Arial, sans-serif;font-size: 12px"}
          = link_to @organization.name, organization_url(@organization)
          |
          = mail_to @organization.email_address, @organization.email_address
        .threadable-unsubscribe{:style => "font-family: Helvetica Neue, Helvetica, Arial, sans-serif;font-size: 10px"}
          = "#{link_to 'unsubscribe', @unsubscribe_url} | #{mail_to @threadable.support_email_address, 'feedback' }".html_safe

  %div{:style => "display:none; display:none !important"}
    = "##CovMid: footer ##"
