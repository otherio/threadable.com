%ol
  - items.each_with_index do |(type, item), index|
    - case type
    - when :message
      %li.with_message
        = render_widget(:message, item, index)
    - when :event
      %li.with_event
        %span.event
          - case item.type
          - when :conversation_created_event
            #{strong(item.user.name)} started this conversation
          - when :task_created_event
            #{strong(item.user.name)} created this task
          - when :task_done_event
            %i.icon-ok.finished-check
            #{strong(item.user.name)} marked this task as done
          - when :task_undone_event
            %i.icon-ok.unfinished-check
            #{strong(item.user.name)} marked this task as not done
          - when :task_added_doer_event
            #{strong(item.user.name)} added #{strong(item.doer.name)} as a doer
          - when :task_removed_doer_event
            #{strong(item.user.name)} removed #{strong(item.doer.name)} as a doer
          - else
            - raise "unknown type #{item.type.inspect}"

          %span.pull-right
            = timeago item.created_at

= render_widget :new_conversation_message, conversation, from: from
